name: Release Desktop (Tauri)

on:
  push:
    tags:
      - "v*"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build_windows:
    name: Build Desktop (Windows)
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: 1.79.0

      - name: Rust cache
        uses: Swatinem/rust-cache@v2

      - name: Install WiX Toolset (for MSI)
        run: choco install wixtoolset -y

      - name: Install Tauri CLI
        run: cargo install tauri-cli --version "^2" --locked

      - name: Build Tauri bundle
        working-directory: desktop/src-tauri
        run: cargo tauri build --bundles msi

      - name: Upload bundles to GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            desktop/src-tauri/target/release/bundle/msi/*.msi
